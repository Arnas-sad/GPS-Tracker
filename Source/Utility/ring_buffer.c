/**********************************************************************************************************************
 * Includes
 *********************************************************************************************************************/
#include <stdint.h>
#include <stdlib.h>
#include <stdbool.h>
#include "ring_buffer.h"
/**********************************************************************************************************************
 * Private definitions and macros
 *********************************************************************************************************************/

/**********************************************************************************************************************
 * Private typedef
 *********************************************************************************************************************/
typedef struct sRingBuffer_t {
    uint8_t *buffer;
    size_t head;
    size_t tail;
    size_t length;
 } sRingBuffer_t;
/**********************************************************************************************************************
 * Private constants
 *********************************************************************************************************************/

/**********************************************************************************************************************
 * Private variables
 *********************************************************************************************************************/
 
/**********************************************************************************************************************
 * Exported variables and references
 *********************************************************************************************************************/

/**********************************************************************************************************************
 * Prototypes of private functions
 *********************************************************************************************************************/
 
/**********************************************************************************************************************
 * Definitions of private functions
 *********************************************************************************************************************/
 
/**********************************************************************************************************************
 * Definitions of exported functions
 *********************************************************************************************************************/
RingBufferHandle_t RingBuffer_Init (size_t max_length) {
    if (max_length == 0) {
        return NULL;
    }

    sRingBuffer_t *rb = (sRingBuffer_t *) calloc(1, sizeof(sRingBuffer_t));

    if (rb == NULL) {
        return NULL;
    }

    rb->buffer = (uint8_t *) calloc(max_length, sizeof(uint8_t)); 

    if (rb->buffer == NULL) {
        free(rb);
        return NULL;
    }

    rb->length = max_length;
    rb->head = 0;
    rb->tail = 0;

    return (RingBufferHandle_t) rb;
};

bool RingBuffer_Put (RingBufferHandle_t rb, uint8_t byte) {
    if ((rb == NULL) || (rb->buffer == NULL) || (byte == 0)) {
        return false;
    }

    if ((rb->head + 1) % rb->length == rb->tail) {
        return false;
    }

    rb->buffer[rb->head] = byte;
    rb->head = (rb->head + 1) % rb->length;

    return true;
}

bool RingBuffer_Get (RingBufferHandle_t rb, uint8_t *byte) {
    if ((rb == NULL) || (rb->buffer == NULL) || (byte == NULL)) {
        return false;
    }

    if (rb->head == rb->tail) {
        return false;
    }

    *byte = rb->buffer[rb->tail];
    rb->tail = (rb->tail + 1) % rb->length;

    return true;
}

bool RingBuffer_Free (RingBufferHandle_t rb) {
    if ((rb == NULL) || (rb->buffer == NULL)) {
        return false;
    }

    free(rb->buffer);

    return true;
}